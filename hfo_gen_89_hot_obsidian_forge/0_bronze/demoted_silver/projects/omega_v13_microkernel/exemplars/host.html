<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Omega v13 - Symbiote Host</title>
    <style>
        body { margin: 0; padding: 0; overflow: hidden; background: #000; }
        
        /* Layer 1 & 2: Video and MediaPipe (Overscan / Background) */
        #video-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 0;
            pointer-events: none; /* Let clicks pass through */
        }

        video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1); /* Mirror */
            opacity: 0.5; /* Transparency to see through */
        }

        canvas.output_canvas {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform: scaleX(-1); /* Mirror */
            opacity: 0.8;
        }

        /* Layer 3, 4, 5: Constrained 2D View, W3C Layer, Dumb Consumer App */
        #exemplar-frame {
            position: absolute;
            top: 5vh; /* Constrained frame */
            left: 5vw;
            width: 90vw;
            height: 90vh;
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            z-index: 1;
            background: transparent; /* Crucial for transparency */
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        /* Layer 6: UI / HFO Overlay */
        #omega-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: 2;
            pointer-events: none; /* Let clicks pass through to the iframe */
        }
        
        /* UI Controls */
        #controls {
            position: absolute;
            top: 20px;
            left: 20px;
            z-index: 3;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 15px;
            border-radius: 8px;
            font-family: monospace;
            pointer-events: auto;
        }
        
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-top: 10px;
        }
        
        button:hover { background: #45a049; }

        /* Monetization Banner */
        #monetization-banner {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 3;
            background: rgba(0, 0, 0, 0.85);
            color: #fff;
            padding: 12px 24px;
            border-radius: 30px;
            font-family: sans-serif;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
            border: 1px solid rgba(255,255,255,0.1);
            pointer-events: auto;
            backdrop-filter: blur(10px);
        }

        #monetization-banner .brand {
            font-weight: bold;
            color: #4CAF50;
            letter-spacing: 1px;
        }

        #monetization-banner .offer {
            color: #aaa;
            font-size: 12px;
        }

        #monetization-banner a {
            color: #4CAF50;
            text-decoration: none;
            font-weight: bold;
        }

        #monetization-banner a:hover {
            text-decoration: underline;
        }

        #monetization-banner button.remove-btn {
            background: transparent;
            border: 1px solid #555;
            color: #ccc;
            padding: 4px 10px;
            border-radius: 15px;
            font-size: 12px;
            cursor: pointer;
            margin: 0;
            transition: all 0.2s;
        }

        #monetization-banner button.remove-btn:hover {
            background: #333;
            color: #fff;
            border-color: #888;
        }
    </style>
</head>
<body>
    <!-- Layer 1 & 2: Video and MediaPipe -->
    <div id="video-container">
        <video id="webcam" autoplay playsinline></video>
        <canvas class="output_canvas" id="output_canvas"></canvas>
    </div>

    <!-- Layer 3, 4, 5: The Target App (Transparent) -->
    <iframe id="exemplar-frame" src="tldraw/index.html" allowtransparency="true"></iframe>

    <!-- Layer 6: The Omega v13 Overlay -->
    <div id="omega-overlay">
        <!-- Visualization plugin will attach its canvas here -->
    </div>

    <!-- Monetization Banner -->
    <div id="monetization-banner">
        <span class="brand">âš¡ OMEGA v13 SUBSTRATE</span>
        <span class="offer">Consultation: $250 (2hr min) | 8-Day Money-Back Guarantee</span>
        <a href="mailto:consulting@example.com">Book Now</a>
        <button class="remove-btn" onclick="document.getElementById('monetization-banner').style.display='none'">Remove Watermark</button>
    </div>

    <div id="controls">
        <h3>Omega v13 Host</h3>
        <p>Target: <select id="app-selector">
            <option value="tldraw/index.html">tldraw</option>
            <option value="simple_canvas/index.html">Simple Canvas</option>
        </select></p>
        <p>
            <label for="overscan-slider">Overscan: <span id="overscan-val">1.0</span>x</label><br>
            <input type="range" id="overscan-slider" min="1.0" max="2.0" step="0.1" value="1.0">
        </p>
        <p>Status: <span id="status">Waiting for camera...</span></p>
        <button id="start-btn">Start Camera</button>
    </div>

    <!-- Load the bundled Omega v13 logic -->
    <script src="bundle.js"></script>
    
    <script>
        // Host logic to switch apps
        document.getElementById('app-selector').addEventListener('change', (e) => {
            document.getElementById('exemplar-frame').src = e.target.value;
        });

        // Overscan logic
        const overscanSlider = document.getElementById('overscan-slider');
        const overscanVal = document.getElementById('overscan-val');
        const videoContainer = document.getElementById('video-container');
        
        overscanSlider.addEventListener('input', (e) => {
            const scale = e.target.value;
            overscanVal.textContent = scale;
            // Apply scale to the video container to create the overscan effect
            videoContainer.style.transform = `scale(${scale})`;
            // We also need to tell demo.js about this scale so it can adjust coordinates
            window.omegaOverscanScale = parseFloat(scale);
        });
        window.omegaOverscanScale = 1.0; // Default
        
        // The symbiote injector logic will be wired up here or inside demo.js
        // For now, we just load the demo.js which handles the camera and gestures.
        // We need to pass the gestures to the iframe.
        
        const iframe = document.getElementById('exemplar-frame');
        
        // Listen for custom events from demo.js (we'll need to make demo.js emit these)
        window.addEventListener('omega-pointer-event', (e) => {
            const { type, x, y } = e.detail;
            
            // Directly inject into same-origin iframe
            if (iframe.contentDocument) {
                const targetElement = iframe.contentDocument.elementFromPoint(x, y) || iframe.contentDocument.body;
                
                const pointerEvent = new PointerEvent(type, {
                    bubbles: true,
                    cancelable: true,
                    clientX: x,
                    clientY: y,
                    pointerId: 1,
                    pointerType: 'touch',
                    isPrimary: true,
                    button: type === 'pointerdown' ? 0 : -1,
                    buttons: type === 'pointerdown' || type === 'pointermove' ? 1 : 0
                });
                
                targetElement.dispatchEvent(pointerEvent);
            }
        });
    </script>
</body>
</html>